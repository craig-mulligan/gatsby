{"version":3,"sources":["../../src/cache-dir/component-renderer.js"],"names":["DefaultLayout","children","ComponentRenderer","props","state","location","pageResources","getResourcesForPathname","pathname","nextProps","setState","on","e","page","path","getPage","nextState","console","log","component","layout","json","layoutJson","layoutProps","key","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,IAAMA,gBAAgB,SAAhBA,aAAgB;AAAA,MAAGC,QAAH,QAAGA,QAAH;AAAA,SACpB;AAAA;AAAA;AACGA;AADH,GADoB;AAAA,CAAtB;;AAMA;AACA;AACA;;IACMC,iB;;;AACJ,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AAEjB,UAAKC,KAAL,GAAa;AACXC,gBAAUF,MAAME,QADL;AAEXC,qBAAe,iBAAOC,uBAAP,CAA+BJ,MAAME,QAAN,CAAeG,QAA9C;AAFJ,KAAb;AAFiB;AAMlB;;;;8CAEyBC,S,EAAW;AAAA;;AACnC,UAAI,KAAKL,KAAL,CAAWC,QAAX,CAAoBG,QAApB,KAAiCC,UAAUJ,QAAV,CAAmBG,QAAxD,EAAkE;AAChE,YAAMF,gBAAgB,iBAAOC,uBAAP,CACpBE,UAAUJ,QAAV,CAAmBG,QADC,CAAtB;AAGA,YAAI,CAACF,aAAL,EAAoB;AAClB;AACA;AACA;AACA,2BAAOC,uBAAP,CACEE,UAAUJ,QAAV,CAAmBG,QADrB,EAEE,yBAAiB;AACf,mBAAKE,QAAL,CAAc;AACZL,wBAAUI,UAAUJ,QADR;AAEZC;AAFY,aAAd;AAID,WAPH;AASD,SAbD,MAaO;AACL,eAAKI,QAAL,CAAc;AACZL,sBAAUI,UAAUJ,QADR;AAEZC;AAFY,WAAd;AAID;AACF;AACF;;;wCAEmB;AAAA;;AAClB;AACA;AACA;AACA,wBAAQK,EAAR,4BAAsC,aAAK;AACzC,YAAIC,EAAEC,IAAF,CAAOC,IAAP,KAAgB,iBAAOC,OAAP,CAAe,OAAKX,KAAL,CAAWC,QAAX,CAAoBG,QAAnC,EAA6CM,IAAjE,EAAuE;AACrE,iBAAKJ,QAAL,CAAc,EAAEJ,eAAeM,EAAEN,aAAnB,EAAd;AACD;AACF,OAJD;AAKD;;AAED;;;;0CACsBG,S,EAAWO,S,EAAW;AAC1CC,cAAQC,GAAR,CAAYF,SAAZ;AACA,UACE,KAAKZ,KAAL,CAAWE,aAAX,CAAyBa,SAAzB,KAAuCH,UAAUV,aAAV,CAAwBa,SADjE,EAEE;AACA,eAAO,IAAP;AACD;AACD,UAAI,KAAKf,KAAL,CAAWE,aAAX,CAAyBc,MAAzB,KAAoCJ,UAAUV,aAAV,CAAwBc,MAAhE,EAAwE;AACtE,eAAO,IAAP;AACD;AACD,UAAI,KAAKhB,KAAL,CAAWE,aAAX,CAAyBe,IAAzB,KAAkCL,UAAUV,aAAV,CAAwBe,IAA9D,EAAoE;AAClE,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;;;6BAEQ;AAAA;;AACP,UAAI,KAAKjB,KAAL,CAAWE,aAAf,EAA8B;AAC5B,eAAO,0BACL,gCAAW,KAAKF,KAAL,CAAWE,aAAX,CAAyBc,MAAzB,IAAmCpB,aAA9C,CADK,6BAEF,KAAKI,KAAL,CAAWE,aAAX,CAAyBgB,UAFvB,EAGF,KAAKnB,KAHH;AAILF,oBAAU,kBAACsB,WAAD;AAAA,mBACR,0BAAc,OAAKnB,KAAL,CAAWE,aAAX,CAAyBa,SAAvC;AACEK,mBAAK,OAAKrB,KAAL,CAAWE,QAAX,CAAoBG;AAD3B,eAEKe,WAFL,EAGK,OAAKpB,KAHV,EAIK,OAAKC,KAAL,CAAWE,aAAX,CAAyBe,IAJ9B,EADQ;AAAA;AAJL,WAAP;AAYD,OAbD,MAaO;AACL,eAAO,IAAP;AACD;AACF;;;EAjF6B,gBAAMI,S;;kBAoFvBvB,iB","file":"component-renderer.js","sourcesContent":["import React, { createElement } from \"react\"\nimport loader from \"./loader\"\nimport emitter from \"./emitter\"\nimport { withRouter } from \"react-router-dom\"\n\nconst DefaultLayout = ({ children }) => (\n  <div>\n    {children()}\n  </div>\n)\n\n// Pass pathname in as prop.\n// component will try fetching resources. If they exist,\n// will just render, else will render null.\nclass ComponentRenderer extends React.Component {\n  constructor(props) {\n    super()\n    this.state = {\n      location: props.location,\n      pageResources: loader.getResourcesForPathname(props.location.pathname),\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.state.location.pathname !== nextProps.location.pathname) {\n      const pageResources = loader.getResourcesForPathname(\n        nextProps.location.pathname\n      )\n      if (!pageResources) {\n        // Page resources won't be set in cases where the browser back button\n        // or forward button is pushed as we can't wait as normal for resources\n        // to load before changing the page.\n        loader.getResourcesForPathname(\n          nextProps.location.pathname,\n          pageResources => {\n            this.setState({\n              location: nextProps.location,\n              pageResources,\n            })\n          }\n        )\n      } else {\n        this.setState({\n          location: nextProps.location,\n          pageResources,\n        })\n      }\n    }\n  }\n\n  componentDidMount() {\n    // Listen to events so when our page gets updated, we can transition.\n    // This is only useful on delayed transitions as the page will get rendered\n    // without the necessary page resources and then re-render once those come in.\n    emitter.on(`onPostLoadPageResources`, e => {\n      if (e.page.path === loader.getPage(this.state.location.pathname).path) {\n        this.setState({ pageResources: e.pageResources })\n      }\n    })\n  }\n\n  // Check if the component or json have changed\n  shouldComponentUpdate(nextProps, nextState) {\n    console.log(nextState)\n    if (\n      this.state.pageResources.component !== nextState.pageResources.component\n    ) {\n      return true\n    }\n    if (this.state.pageResources.layout !== nextState.pageResources.layout) {\n      return true\n    }\n    if (this.state.pageResources.json !== nextState.pageResources.json) {\n      return true\n    }\n    return false\n  }\n\n  render() {\n    if (this.state.pageResources) {\n      return createElement(\n        withRouter(this.state.pageResources.layout || DefaultLayout), {\n        ...this.state.pageResources.layoutJson,\n        ...this.props,\n        children: (layoutProps) =>\n          createElement(this.state.pageResources.component, {\n            key: this.props.location.pathname,\n            ...layoutProps,\n            ...this.props,\n            ...this.state.pageResources.json,\n          })\n        })\n    } else {\n      return null\n    }\n  }\n}\n\nexport default ComponentRenderer\n"]}