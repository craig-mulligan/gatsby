{"version":3,"sources":["../../src/cache-dir/component-renderer.js"],"names":["DefaultLayout","children","ComponentRenderer","props","state","location","pageResources","getResourcesForPathname","pathname","nextProps","setState","on","e","page","path","getPage","nextState","component","layout","json","key","matchPath","layoutJson","layoutProps","Component"],"mappings":"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","file":"component-renderer.js","sourcesContent":["import React, { createElement } from \"react\"\nimport loader from \"./loader\"\nimport emitter from \"./emitter\"\nimport { withRouter } from \"react-router-dom\"\n\nconst DefaultLayout = ({ children }) =>\n  <div>\n    {children()}\n  </div>\n\n// Pass pathname in as prop.\n// component will try fetching resources. If they exist,\n// will just render, else will render null.\nclass ComponentRenderer extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      location: props.location,\n      pageResources: loader.getResourcesForPathname(props.location.pathname),\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    // hmm, would this ever be false?\n\n    if (this.state.pageResources !== nextProps.pageResources) {\n      const pageResources = loader.getResourcesForPathname(\n        nextProps.location.pathname\n      )\n      if (!pageResources) {\n        // Page resources won't be set in cases where the browser back button\n        // or forward button is pushed as we can't wait as normal for resources\n        // to load before changing the page.\n        loader.getResourcesForPathname(\n          nextProps.location.pathname,\n          pageResources => {\n            this.setState({\n              location: nextProps.location,\n              pageResources,\n            })\n          }\n        )\n      } else {\n        this.setState({\n          location: nextProps.location,\n          pageResources,\n        })\n      }\n    }\n  }\n\n  componentDidMount() {\n    // Listen to events so when our page gets updated, we can transition.\n    // This is only useful on delayed transitions as the page will get rendered\n    // without the necessary page resources and then re-render once those come in.\n    emitter.on(`onPostLoadPageResources`, e => {\n      if (e.page.path === loader.getPage(this.state.location.pathname).path) {\n        this.setState({ pageResources: e.pageResources })\n      }\n    })\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // Check if the component or json have changed.\n    if (\n      this.state.pageResources.component !== nextState.pageResources.component\n    ) {\n      return true\n    }\n    if (this.state.pageResources.layout !== nextState.pageResources.layout) {\n      return true\n    }\n    if (this.state.pageResources.json !== nextState.pageResources.json) {\n      return true\n    }\n    // Check if location has changed on a page using internal routing\n    // via matchPath configuration.\n    if (\n      this.state.location.key !== nextState.location.key &&\n      nextState.pageResources.page &&\n      nextState.pageResources.page.matchPath\n    ) {\n      return true\n    }\n    return false\n  }\n\n  render() {\n    if (this.state.pageResources) {\n      return createElement(\n        withRouter(this.state.pageResources.layout || DefaultLayout),\n        {\n          ...this.state.pageResources.layoutJson,\n          ...this.props,\n          children: layoutProps =>\n            createElement(this.state.pageResources.component, {\n              key: this.props.location.pathname,\n              ...layoutProps,\n              ...this.props,\n              ...this.state.pageResources.json,\n            }),\n        }\n      )\n    } else {\n      return null\n    }\n  }\n}\n\nexport default ComponentRenderer\n"]}