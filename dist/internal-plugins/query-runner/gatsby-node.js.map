{"version":3,"sources":["../../../src/internal-plugins/query-runner/gatsby-node.js"],"names":["fs","require","path","watchComponent","components","handlePageOrLayout","writeJsonFile","jsonName","dest","join","store","getState","program","directory","existsSync","writeFile","pageOrLayout","component","componentPath","exports","onCreatePage","page","boundActionCreators","onCreateLayout","layout"],"mappings":";;AAAA,IAAMA,KAAKC,aAAX;AACA,IAAMC,OAAOD,eAAb;;eAC2BA,0B;IAAnBE,c,YAAAA,c;;AAER,IAAIC,aAAa,EAAjB;;AAEA,IAAMC,qBAAqB,SAArBA,kBAAqB;AAAA,SAAS,wBAAgB;AAClD;AACA;AACA;AACA;AACA,QAAMC,gBAAgB,SAAhBA,aAAgB,OAAkB;AAAA,UAAfC,QAAe,QAAfA,QAAe;;AACtC,UAAMC,OAAON,KAAKO,IAAL,CACXC,MAAMC,QAAN,GAAiBC,OAAjB,CAAyBC,SADd,oBAIXN,QAJW,CAAb;AAMA,UAAI,CAACP,GAAGc,UAAH,CAAcN,IAAd,CAAL,EAA0B;AACxBR,WAAGe,SAAH,CAAaP,IAAb,QAAyB,YAAM,CAAE,CAAjC;AACD;AACF,KAVD;;AAYAF,kBAAcU,YAAd;;AAEA,QAAMC,YAAYP,MAAMC,QAAN,GAAiBP,UAAjB,CAA4BY,aAAaE,aAAzC,CAAlB;;AAEA,QAAId,WAAWa,UAAUC,aAArB,CAAJ,EAAyC;AACvC;AACD;;AAEDf,mBAAec,UAAUC,aAAzB;AACAd,eAAWa,UAAUC,aAArB,IAAsCD,UAAUC,aAAhD;AACD,GA3B0B;AAAA,CAA3B;;AA6BAC,QAAQC,YAAR,GAAuB,iBAA0C;AAAA,MAAvCC,IAAuC,SAAvCA,IAAuC;AAAA,MAAjCX,KAAiC,SAAjCA,KAAiC;AAAA,MAA1BY,mBAA0B,SAA1BA,mBAA0B;;AAC/DjB,qBAAmBK,KAAnB,EAA0BW,IAA1B;AACD,CAFD;;AAIAF,QAAQI,cAAR,GAAyB,iBAA4C;AAAA,MAAzCC,MAAyC,SAAzCA,MAAyC;AAAA,MAAjCd,KAAiC,SAAjCA,KAAiC;AAAA,MAA1BY,mBAA0B,SAA1BA,mBAA0B;;AACnEjB,qBAAmBK,KAAnB,EAA0Bc,MAA1B;AACD,CAFD","file":"gatsby-node.js","sourcesContent":["const fs = require(`fs`)\nconst path = require(`path`)\nconst { watchComponent } = require(`./query-watcher`)\n\nlet components = {}\n\nconst handlePageOrLayout = store => pageOrLayout => {\n  // - ensure corresponding page or layout has json files.\n  // - get corresponding component\n  // - watch component\n  // - mark component\n  const writeJsonFile = ({ jsonName }) => {\n    const dest = path.join(\n      store.getState().program.directory,\n      `.cache`,\n      `json`,\n      jsonName\n    )\n    if (!fs.existsSync(dest)) {\n      fs.writeFile(dest, `{}`, () => {})\n    }\n  }\n\n  writeJsonFile(pageOrLayout)\n\n  const component = store.getState().components[pageOrLayout.componentPath]\n\n  if (components[component.componentPath]) {\n    return\n  }\n\n  watchComponent(component.componentPath)\n  components[component.componentPath] = component.componentPath\n}\n\nexports.onCreatePage = ({ page, store, boundActionCreators }) => {\n  handlePageOrLayout(store)(page)\n}\n\nexports.onCreateLayout = ({ layout, store, boundActionCreators }) => {\n  handlePageOrLayout(store)(layout)\n}\n"]}